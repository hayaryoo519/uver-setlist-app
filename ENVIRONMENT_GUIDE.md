# ç’°å¢ƒæ§‹æˆã‚¬ã‚¤ãƒ‰

> [!CAUTION]
> ## âš ï¸ æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯çµ¶å¯¾ã«ç›´æ¥æ“ä½œã—ãªã„ã§ãã ã•ã„ âš ï¸
> 
> ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯**3ã¤ã®ç‹¬ç«‹ã—ãŸç’°å¢ƒ**ãŒã‚ã‚Šã¾ã™ã€‚å„ç’°å¢ƒã¯å®Œå…¨ã«åˆ†é›¢ã•ã‚Œã¦ãŠã‚Šã€**æœ¬ç•ªç’°å¢ƒã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’èª¤ã£ã¦æ“ä½œã™ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å½±éŸ¿ãŒå‡ºã¾ã™**ã€‚
> 
> ### ç’°å¢ƒã®ä½¿ã„åˆ†ã‘ï¼š
> - **é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆ** â†’ ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ ã¾ãŸã¯ æ¤œè¨¼ç’°å¢ƒã‚’ä½¿ç”¨
> - **æœ¬ç•ªç¢ºèªã®ã¿** â†’ æœ¬ç•ªç’°å¢ƒã¯èª­ã¿å–ã‚Šå°‚ç”¨ã§ç¢ºèªã™ã‚‹ã ã‘
> - **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ** â†’ å¿…ãšãƒ­ãƒ¼ã‚«ãƒ«ã¾ãŸã¯æ¤œè¨¼ç’°å¢ƒã§å®Ÿæ–½
> 
> ğŸš¨ **æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®æ›¸ãè¾¼ã¿ãƒ»å‰Šé™¤ãƒ»å¤‰æ›´ã¯å³ç¦ã§ã™ï¼** ğŸš¨

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯3ã¤ã®ç’°å¢ƒãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œãã‚Œã®ç›®çš„ã¨ä½¿ã„åˆ†ã‘ã‚’ç†è§£ã—ã¦ãã ã•ã„ã€‚

## ç’°å¢ƒä¸€è¦§

| ç’°å¢ƒ | å ´æ‰€ | URL | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | ç”¨é€” |
|:---|:---|:---|:---|:---|
| **ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º** | Windows PC | http://localhost:8000 | Docker Supabase (ãƒãƒ¼ãƒˆ54332) | æ—¥å¸¸ã®é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆ |
| **æ¤œè¨¼ï¼ˆStagingï¼‰** | ã‚µãƒ¼ãƒãƒ¼ | http://192.168.0.13:9000 | Docker PostgreSQL (ãƒãƒ¼ãƒˆ54323) | æœ¬ç•ªåæ˜ å‰ã®æœ€çµ‚ç¢ºèª |
| **æœ¬ç•ªï¼ˆProductionï¼‰** | ã‚µãƒ¼ãƒãƒ¼ | http://192.168.0.13:8000 | PostgreSQL (ãƒãƒ¼ãƒˆ5432) | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ç’°å¢ƒ |

---

## 1. ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: Docker Supabase

**ãªãœSupabaseã‚’ä½¿ã†ã®ã‹ï¼Ÿ**
- **å®Œå…¨ãªãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¹ã‚¿ãƒƒã‚¯**: PostgreSQL + Auth + Realtime + Storage + Row Level Security
- **æœ¬ç•ªã«è¿‘ã„ç’°å¢ƒ**: SupabaseãŒæä¾›ã™ã‚‹æ©Ÿèƒ½ã‚’å…¨ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆå¯èƒ½
- **ç‹¬ç«‹æ€§**: æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã‚’å£Šã™å¿ƒé…ãªãã€è‡ªç”±ã«å®Ÿé¨“ãƒ»é–‹ç™ºã§ãã‚‹
- **ç°¡å˜ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**: Dockerã§ä¸€ç™ºèµ·å‹•ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚ç®¡ç†ã—ã‚„ã™ã„

### èµ·å‹•æ–¹æ³•

æ—¢ã«Dockerã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ã„ã‚‹å ´åˆï¼ˆé€šå¸¸ã¯ã“ã¡ã‚‰ï¼‰:
```powershell
# ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
cd C:\Users\oault\.gemini\antigravity\scratch\uver-setlist-app
$env:NODE_ENV="production"; node server/index.js
```

Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’å†èµ·å‹•ã™ã‚‹å ´åˆ:
```powershell
docker restart supabase_db_marumie
```

### æ¥ç¶šè¨­å®šï¼ˆ`server/.env`ï¼‰
```bash
DB_USER=postgres
DB_PASSWORD=postgres
DB_HOST=localhost
DB_PORT=54332
DB_NAME=uver_app_db
```

### ç¢ºèª
```powershell
# APIãƒ†ã‚¹ãƒˆ
Invoke-WebRequest -Uri http://localhost:8000/api/lives -UseBasicParsing
# æœŸå¾…: 200 OK, 607ä»¶ã®ãƒ‡ãƒ¼ã‚¿
```

---

## 2. æ¤œè¨¼ç’°å¢ƒï¼ˆStagingï¼‰

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: Docker PostgreSQL

ã‚·ãƒ³ãƒ—ãƒ«ãªPostgreSQLã‚³ãƒ³ãƒ†ãƒŠã€‚æœ¬ç•ªã¨åŒã˜ã‚³ãƒ¼ãƒ‰ãƒ»è¨­å®šã§å‹•ä½œç¢ºèªã™ã‚‹ç’°å¢ƒã€‚

### èµ·å‹•æ–¹æ³•

ã‚µãƒ¼ãƒãƒ¼ã«SSHã§æ¥ç¶š:
```bash
ssh haya-ryoo@192.168.0.13
cd ~/apps/uver-setlist-staging
docker compose up -d --build
```

### æ¥ç¶šè¨­å®šï¼ˆã‚µãƒ¼ãƒãƒ¼ä¸Šã®`server/.env`ï¼‰
```bash
DB_USER=postgres
DB_PASSWORD=postgres
DB_HOST=localhost
DB_PORT=54332
DB_NAME=uver_app_db
```

### ç¢ºèª
```bash
curl http://192.168.0.13:9000/api/lives
```

---

## 3. æœ¬ç•ªç’°å¢ƒï¼ˆProductionï¼‰

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: PostgreSQL (Bare Metal)

ã‚µãƒ¼ãƒãƒ¼ã«ç›´æ¥ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸPostgreSQLã€‚

### èµ·å‹•æ–¹æ³•

é€šå¸¸ã¯ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å¸¸æ™‚ç¨¼åƒä¸­ã€‚å†èµ·å‹•ãŒå¿…è¦ãªå ´åˆ:
```bash
ssh haya-ryoo@192.168.0.13
cd ~/apps/uver-setlist-app/server
NODE_ENV=production nohup node index.js > server.log 2>&1 &
```

### æ¥ç¶šè¨­å®šï¼ˆã‚µãƒ¼ãƒãƒ¼ä¸Šã®`server/.env`ï¼‰
```bash
DB_NAME=uver_setlist_prod
DB_USER=haya-ryoo
DB_PASSWORD='A1oaulth!'
DB_HOST=localhost
DB_PORT=5432
```

### ç¢ºèª
```bash
curl http://192.168.0.13:8000/api/lives
```

---

## é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### æ—¥å¸¸ã®é–‹ç™º
1. **ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ**ã§é–‹ç™º
2. GitHubã«push

### æœ¬ç•ªåæ˜ å‰ã®ãƒ†ã‚¹ãƒˆ
1. ã‚µãƒ¼ãƒãƒ¼ã«SSHæ¥ç¶š
2. **æ¤œè¨¼ç’°å¢ƒ**ã§`git pull`ã—ã¦å‹•ä½œç¢ºèª
3. å•é¡Œãªã‘ã‚Œã°**æœ¬ç•ªç’°å¢ƒ**ã«ãƒ‡ãƒ—ãƒ­ã‚¤

---

## ã‚ˆãã‚ã‚‹è³ªå•

### Q: ãªãœãƒ­ãƒ¼ã‚«ãƒ«ã ã‘Supabaseãªã®ã‹ï¼Ÿ
A: Supabaseã¯é–‹ç™ºã«ä¾¿åˆ©ãªæ©Ÿèƒ½ï¼ˆAdmin UIã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ã€èªè¨¼ãªã©ï¼‰ã‚’æä¾›ã—ã¦ã„ã‚‹ãŸã‚ã€‚æœ¬ç•ªã¯ã‚·ãƒ³ãƒ—ãƒ«ãªPostgreSQLã§ååˆ†ã§ã™ãŒã€é–‹ç™ºä½“é¨“ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã«Supabaseã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

### Q: æœ¬ç•ªDBã«ç›´æ¥æ¥ç¶šã—ãŸã„å ´åˆã¯ï¼Ÿ
A: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šæ¨å¥¨ã•ã‚Œã¾ã›ã‚“ãŒã€å¿…è¦ãªå ´åˆã¯SSHãƒˆãƒ³ãƒãƒ«çµŒç”±ã§æ¥ç¶šã§ãã¾ã™ï¼š
```bash
ssh -L 5433:localhost:5432 haya-ryoo@192.168.0.13
```
ãã®å¾Œã€`server/.env`ã®æœ¬ç•ªè¨­å®šã‚’æœ‰åŠ¹åŒ–ã—ã¦ãã ã•ã„ã€‚

### Q: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¯ï¼Ÿ
A: æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯æ¯æ—¥æ·±å¤œ3æ™‚ã«è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã•ã‚Œã€éå»7æ—¥åˆ†ãŒä¿æŒã•ã‚Œã¾ã™ã€‚

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ãˆãªã„
```powershell
# Dockerã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ç¢ºèª
docker ps -a | findstr supabase

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèª
node -e "require('dotenv').config({ path: './server/.env' }); const { Pool } = require('pg'); const pool = new Pool({ user: process.env.DB_USER, host: process.env.DB_HOST, database: process.env.DB_NAME, password: process.env.DB_PASSWORD, port: process.env.DB_PORT }); pool.query('SELECT COUNT(*) FROM lives', (err, res) => { if (err) console.error('Error:', err.message); else console.log('Lives count:', res.rows[0].count); pool.end(); });"
```

### æœ¬ç•ªã‚µãƒ¼ãƒãƒ¼ã§ã‚¨ãƒ©ãƒ¼
```bash
# ãƒ­ã‚°ç¢ºèª
ssh haya-ryoo@192.168.0.13 "tail -50 ~/apps/uver-setlist-app/server/server.log"

# ãƒ—ãƒ­ã‚»ã‚¹ç¢ºèª
ssh haya-ryoo@192.168.0.13 "ps aux | grep 'node.*server'"
```
